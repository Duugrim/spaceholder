# AGENTS.md

Руководство для контрибьютеров и AI-агентов, работающих с системой SpaceHolder для FoundryVTT.

## Структура проекта

SpaceHolder — это игровая система для FoundryVTT, организованная следующим образом:

- **`module/`** — основной код системы (ES modules)
  - `spaceholder.mjs` — точка входа, инициализация хуков
  - `documents/` — классы Actor и Item
  - `sheets/` — Application V2 листы персонажей и предметов
  - `helpers/` — вспомогательные модули (timeline, icon-picker, shot-manager, etc.)
  - `data/` — JSON-данные (анатомии, конфигурации)
- **`templates/`** — Handlebars шаблоны для UI
- **`src/scss/`** — исходники стилей (SCSS)
- **`css/`** — скомпилированные стили
- **`lang/`** — локализация (en.json, ru.json)
- **`docs/`** — техническая документация систем (анатомия, прицеливание, зоны влияния)
- **`packs/`** — compendium пакеты

## Команды сборки и разработки

```bash
# Компиляция SCSS в CSS (однократно)
npm run build

# Автоматическая пересборка при изменениях (для разработки)
npm run watch
```

**Важно:** После изменения `.scss` файлов запустите `npm run build` или `npm run watch`, чтобы обновить `css/spaceholder.css`.

## Стиль кода и соглашения

### JavaScript/ES Modules
- Используйте ES6+ синтаксис (import/export)
- Именование классов: `PascalCase` (например, `AnatomyManager`, `ShotManager`)
- Именование функций и переменных: `camelCase`
- Константы: `UPPER_SNAKE_CASE` (например, `SPACEHOLDER`)
- Комментарии: JSDoc для публичных методов, краткие inline-комментарии для сложной логики
- Избегайте "магических значений" — выносите литералы в именованные константы

### Handlebars Templates
- Файлы: `.hbs` расширение
- Размещение: `templates/` с подпапками по типу (actor, item, timeline, etc.)

### SCSS/CSS
- Исходники в `src/scss/`, компиляция в `css/`
- Используйте вложенность и переменные SCSS
- Префиксы классов: `.spaceholder-*` для избежания конфликтов

### Тестирование
- Тестовые скрипты: `test-*.js` в корне проекта
- Запуск: `node test-<name>.js` (для Node.js скриптов)
- Для тестирования в FoundryVTT используйте консоль браузера и макросы

## Соглашения о коммитах и PR

### Формат коммитов
Анализ истории показывает краткие описательные сообщения на английском:
- Используйте императивное наклонение: `Add feature`, `Fix bug`, `Update docs`
- Примеры из истории:
  - `icons for factions instead of color swatches`
  - `Timeline V2: LIVE!`
  - `Journal check: rejected and bulk-actions`
  - `hotfix timeline`

### Pull Requests
- Описание: кратко объясните, что изменено и зачем
- Связанные issue: укажите номер issue, если применимо (`Fixes #123`)
- Тестирование: опишите, как проверить изменения в FoundryVTT

## Архитектура и ключевые системы

### Менеджеры и модули
- **AnatomyManager** — управление анатомиями существ (загрузка, кэширование)
- **ShotManager** — расчёт выстрелов и попаданий
- **DrawManager** — визуализация траекторий выстрелов
- **InfluenceManager** — зоны влияния глобальных объектов
- **Timeline V2** — система таймлайна для управления событиями
- **Icon Library & Picker** — библиотека иконок и UI для выбора
- **Token Pointer/Rotator** — управление указателями и поворотом токенов
- **User Factions** — привязка пользователей к фракциям
- **Progression Points** — система прогрессии персонажей
- **Journal Check** — статусы workflow для журналов

### Документация
Подробные описания систем находятся в `docs/`:
- `ANATOMY_SYSTEM.md` — система анатомий
- `AIMING_SYSTEM_DOCUMENTATION.md` — система прицеливания
- `HEALTH_SYSTEM_DOCUMENTATION.md` — система здоровья
- `influence-zones.md` — зоны влияния
- `GLOBAL_MAP_ARCHITECTURE.md` — архитектура глобальных карт

## Советы для AI-агентов

- **Перед редактированием** прочитайте целевой файл целиком, чтобы понять контекст
- **Не используйте fully qualified names** без необходимости
- **Проверяйте зависимости**: убедитесь, что импорты корректны
- **Тестируйте в FoundryVTT**: система работает в контексте Foundry, проверяйте изменения в реальной среде
- **Читайте docs/**: перед изменением сложных систем изучите документацию в `docs/`
- **Локализация**: при добавлении UI-текстов добавляйте ключи в `lang/en.json` и `lang/ru.json`

---

**Версия системы:** 0.164  
**Совместимость:** FoundryVTT v13+  
**Лицензия:** MIT
