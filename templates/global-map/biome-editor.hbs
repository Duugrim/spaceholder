<div id="global-map-biome-editor" class="sh-biome-editor">
  <div class="sh-biome-editor__header">
    <div>
      <div class="sh-biome-editor__title">Редактор биомов (Global Map)</div>
      {{#if filePath}}
        <div class="sh-biome-editor__meta">
          Файл overrides: <code>{{filePath}}</code>
        </div>
      {{/if}}
      <div class="sh-biome-editor__meta">
        Примечание: чтобы игроки подтянули новые биомы, им достаточно нажать «Загрузить из файла» в панели Global Map.
      </div>
    </div>

    <div class="sh-biome-editor__actions">
      <button type="button" data-action="add-biome" class="sh-biome-editor__btn sh-biome-editor__btnAdd">Новый биом</button>
      <button type="button" data-action="reload" class="sh-biome-editor__btn">Перезагрузить</button>
      <button type="button" data-action="reset-overrides" class="sh-biome-editor__btn sh-biome-editor__btnDanger">Сбросить overrides</button>
      <button type="button" data-action="save" class="sh-biome-editor__btn sh-biome-editor__btnSave">Сохранить</button>
    </div>
  </div>

  <div class="sh-biome-editor__hint">
    Ограничение: ID биома 0..255 (Uint8Array).
  </div>

  <div class="sh-biome-editor__list">
    {{#each biomes as |b|}}
      <div class="sh-biome-editor__card" data-biome-id="{{b.id}}">
        <div class="sh-biome-editor__cardRow">
          <canvas
            class="sh-biome-editor__preview"
            data-preview="biome"
            data-biome-id="{{b.id}}"
            width="64"
            height="64"
          ></canvas>

          <div class="sh-biome-editor__fields">
            <div class="sh-biome-editor__row">
              <div class="sh-biome-editor__id">ID: <b>{{b.id}}</b></div>

              <label class="sh-biome-editor__field wide">
                <span class="sh-biome-editor__label">Название</span>
                <input type="text" data-field="name" value="{{b.name}}" />
              </label>

              <label class="sh-biome-editor__field">
                <span class="sh-biome-editor__label">Ранг</span>
                <input
                  type="number"
                  data-field="renderRank"
                  value="{{b.renderRank}}"
                  step="1"
                  class="sh-biome-editor__input--rank"
                />
              </label>
            </div>

            <div class="sh-biome-editor__row">
              <label class="sh-biome-editor__field">
                <span class="sh-biome-editor__label">Цвет</span>
                <input type="color" data-field="color" value="{{b.color}}" />
                <code class="sh-biome-editor__patternCode">{{b.color}}</code>
              </label>

              <label class="sh-biome-editor__field wide">
                <span class="sh-biome-editor__label">Паттерн</span>
                <select data-field="pattern.type">
                  {{#each ../patternTypes as |pt|}}
                    <option value="{{pt.value}}" {{#if (eq pt.value b.pattern.type)}}selected{{/if}}>{{pt.label}}</option>
                  {{/each}}
                </select>
              </label>

              <label class="sh-biome-editor__field wide">
                <span class="sh-biome-editor__label">Цвет паттерна</span>
                <input type="color" data-field="pattern.patternColor" value="{{#if b.pattern.patternColor}}{{b.pattern.patternColor}}{{else}}#000000{{/if}}" />
                <button type="button" data-action="pattern-color-auto" class="sh-biome-editor__btn">Авто</button>
                <code data-display="pattern.patternColor" class="sh-biome-editor__patternCode">{{#if b.pattern.patternColor}}{{b.pattern.patternColor}}{{else}}(авто){{/if}}</code>
              </label>
            </div>

            <details class="sh-biome-editor__details">
              <summary>Доп. параметры паттерна</summary>
              <div class="sh-biome-editor__detailsBody">
                <label class="sh-biome-editor__field">
                  <span class="sh-biome-editor__label">Spacing</span>
                  <input type="number" data-field="pattern.spacing" value="{{b.pattern.spacing}}" step="0.1" min="0.1" class="sh-biome-editor__input--xs" />
                </label>

                <label class="sh-biome-editor__field">
                  <span class="sh-biome-editor__label">LineWidth</span>
                  <input type="number" data-field="pattern.lineWidth" value="{{b.pattern.lineWidth}}" step="0.05" min="0.01" class="sh-biome-editor__input--xs" />
                </label>

                <label class="sh-biome-editor__field">
                  <span class="sh-biome-editor__label">Opacity</span>
                  <input type="number" data-field="pattern.opacity" value="{{b.pattern.opacity}}" step="0.05" min="0" max="1" class="sh-biome-editor__input--xs" />
                </label>

                <label class="sh-biome-editor__field">
                  <span class="sh-biome-editor__label">Darken</span>
                  <input type="number" data-field="pattern.darkenFactor" value="{{b.pattern.darkenFactor}}" step="0.05" min="0" max="1" class="sh-biome-editor__input--xs" />
                </label>
              </div>
            </details>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
</div>
