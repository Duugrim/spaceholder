Global Map Tools — план работ (временный)
E:\FoundryVTT\Data\systems\spaceholder\module\helpers\global-map
Набор модулей для глобальной карты.

Следующий этап:
- [x] Убрать легаси инструмент Modify Biome (нет больше системы влажности/температуры)
- [x] Сделать ползунок прозрачности линий высот для теста

План (P1 — после P0, в следующие итерации)
- [x] P1.1 Clamp высот в диапазон 0..100 при commit/операциях.
- [x] P1.2 Undo/Redo (хотя бы 1 шаг) для кисти.
- [x] P1.3 Корректная реакция на смену сцены/canvasReady (авто-deactivate или безопасный reset overlays).
- [x] P1.4 Переход UI выбора инструментов с select на кнопки (категории + режимы).

Прогресс (обновляется по мере работы)
- [x] P0.1 Event lifecycle (canvas.stage)
- [x] P0.2 State reset
- [x] P0.3 Flatten + pipette
- [x] P0.4 Tool/DOM consistency
- [x] P0.5 UI cleanup
- [x] P0.6 Comments

Лог
- 2025-12-22: план создан
- 2025-12-22: выполнены P0.1–P0.6 (listeners lifecycle, reset state, Flatten UI + Alt+Click pipette, консистентность tool/id, cleanup document handlers, комментарии про half-cell offset)
- 2025-12-22: выполнен P1.2 (Undo/Redo для grid-правок: кнопки + Ctrl/Cmd+Z, Ctrl+Y, Ctrl+Shift+Z)
- 2025-12-22: выполнен P1.1 (Clamp высот 0..100 при commit и глобальных операциях)
- 2025-12-22: выполнен P1.3 (canvasReady: авто-deactivate при смене сцены; same-scene refresh: rebind stage listeners + пересоздание overlay/cursor/handles; renderer хранит scene id, очищает stale refs и пере-рендерит карту после canvas rebuild; rivers не перезатираются при несохранённых правках на same-scene refresh)
- 2025-12-22: выполнен P1.4 (tool/mode selects заменены на группы кнопок; выбор инструмента хранится per-tab; корректное disable при активной кисти; river-finish переключает режим без select)
- 2025-12-23: убран инструмент Modify Biome; добавлен ползунок прозрачности изолиний высот (heightContourAlpha)
