# Документация: Настройка биомов и паттернов

## Обзор

Система Global Map поддерживает отображение биомов с различными визуальными паттернами. Паттерны добавляют текстуру поверх основного цвета биома, делая карту более выразительной и информативной.

## Конфигурация биомов

Все настройки биомов находятся в файле `biome-config.json` в секции `biomeColors`.

### Структура базового биома (без паттерна)

```json
{
  "id": 0,
  "name": "Айсберг",
  "color": "E8F4F8"
}
```

### Структура биома с паттерном

```json
{
  "id": 7,
  "name": "Болото",
  "color": "5B7C99",
  "pattern": {
    "type": "spots",
    "spacing": 2.0,
    "lineWidth": 0.8,
    "darkenFactor": 0.5,
    "opacity": 0.7
  }
}
```

## Параметры паттерна

### `type` (обязательный)
Тип паттерна. Доступные значения:
- `"diagonal"` - диагональные линии (/)
- `"crosshatch"` - сетка из диагоналей (/\)
- `"vertical"` - вертикальные линии (|)
- `"horizontal"` - горизонтальные линии (—)
- `"dots"` - регулярная сетка точек
- `"waves"` - плавные волнистые линии
- `"circles"` - концентрические круги
- `"hexagons"` - шестиугольники (соты)
- `"spots"` - случайные пятна

### `spacing` (обязательный)
Расстояние между элементами паттерна (линиями, точками, кругами).
- Множитель от размера ячейки сетки (`cellSize`)
- **Рекомендуемые значения:** 1.5 - 3.0
- **Меньше значение** = более плотный паттерн
- **Больше значение** = более разреженный паттерн

### `lineWidth` (обязательный)
Толщина линий или размер элементов паттерна.
- Множитель от размера ячейки сетки
- **Рекомендуемые значения:**
  - Линии: 0.4 - 0.8
  - Точки/пятна: 0.2 - 0.5
  - Шестиугольники: 0.2 - 0.4

### `darkenFactor` (обязательный)
Насколько затемнить цвет паттерна относительно основного цвета биома.
- Значение от 0.0 до 1.0
- **0.0** = паттерн того же цвета, что и биом
- **1.0** = паттерн черный
- **Рекомендуемые значения:** 0.2 - 0.5

### `opacity` (обязательный)
Прозрачность паттерна.
- Значение от 0.0 до 1.0
- **0.0** = полностью прозрачный (невидимый)
- **1.0** = полностью непрозрачный
- **Рекомендуемые значения:** 0.7 - 0.9

## Примеры паттернов для разных биомов

### Водные биомы (волны)
```json
{
  "id": 2,
  "name": "Океан",
  "color": "4A90E2",
  "pattern": {
    "type": "waves",
    "spacing": 3.0,
    "lineWidth": 0.5,
    "darkenFactor": 0.4,
    "opacity": 0.85
  }
}
```

### Холодные биомы (точки для снега/льда)
```json
{
  "id": 5,
  "name": "Льды",
  "color": "F0F8FF",
  "pattern": {
    "type": "dots",
    "spacing": 2.5,
    "lineWidth": 0.25,
    "darkenFactor": 0.15,
    "opacity": 0.7
  }
}
```

### Болота (случайные пятна)
```json
{
  "id": 7,
  "name": "Болото",
  "color": "5B7C99",
  "pattern": {
    "type": "spots",
    "spacing": 2.0,
    "lineWidth": 0.8,
    "darkenFactor": 0.5,
    "opacity": 0.7
  }
}
```

### Пустыни (вертикальные линии для ветра)
```json
{
  "id": 28,
  "name": "Жаркая пустыня",
  "color": "FFD700",
  "pattern": {
    "type": "vertical",
    "spacing": 2.5,
    "lineWidth": 0.5,
    "darkenFactor": 0.3,
    "opacity": 0.8
  }
}
```

### Аномальные зоны (концентрические круги)
```json
{
  "id": 29,
  "name": "Шрам",
  "color": "8B0000",
  "pattern": {
    "type": "circles",
    "spacing": 2.0,
    "lineWidth": 0.4,
    "darkenFactor": 0.4,
    "opacity": 0.9
  }
}
```

### Тундра (горизонтальные линии)
```json
{
  "id": 16,
  "name": "Тундра",
  "color": "9DB8A8",
  "pattern": {
    "type": "horizontal",
    "spacing": 2.0,
    "lineWidth": 0.4,
    "darkenFactor": 0.3,
    "opacity": 0.8
  }
}
```

### Магические зоны (шестиугольники)
```json
{
  "id": 25,
  "name": "Иниевая пустошь",
  "color": "E0E0D0",
  "pattern": {
    "type": "hexagons",
    "spacing": 2.0,
    "lineWidth": 0.2,
    "darkenFactor": 0.25,
    "opacity": 0.7
  }
}
```

### Сложный ландшафт (сетка)
```json
{
  "id": 26,
  "name": "Холодная пустыня",
  "color": "D4C5B9",
  "pattern": {
    "type": "crosshatch",
    "spacing": 3.0,
    "lineWidth": 0.4,
    "darkenFactor": 0.35,
    "opacity": 0.75
  }
}
```

## Рекомендации по подбору паттернов

### По типу местности:
- **Водные** → `waves` (волны)
- **Заснеженные** → `dots` (точки)
- **Болотистые** → `spots` (пятна)
- **Пустыни** → `vertical` или `horizontal` (ветер)
- **Леса** → `diagonal` (стволы деревьев)
- **Степи** → `horizontal` (трава)
- **Горы** → `crosshatch` (пересеченная местность)
- **Аномалии** → `circles` или `hexagons`

### По визуальной плотности:
- **Минималистичные** → большой `spacing` (3.0+), малый `lineWidth` (0.3-)
- **Средние** → `spacing` 2.0-2.5, `lineWidth` 0.4-0.6
- **Насыщенные** → малый `spacing` (1.5-2.0), большой `lineWidth` (0.6+)

### По контрасту:
- **Светлые биомы** → больший `darkenFactor` (0.4-0.6)
- **Темные биомы** → меньший `darkenFactor` (0.2-0.3)

## Применение изменений

После редактирования `biome-config.json`:
1. Перезагрузите страницу Foundry VTT (F5)
2. Откройте сцену с глобальной картой
3. Паттерны применятся автоматически при следующей загрузке карты

## Отладка

Если паттерн не отображается:
- Проверьте правильность JSON-синтаксиса в `biome-config.json`
- Убедитесь, что все обязательные поля указаны
- Проверьте консоль браузера (F12) на наличие ошибок
- Убедитесь, что `type` указан корректно (с учетом регистра)

## Производительность

- Паттерны рендерятся с использованием PIXI.Graphics
- Маски применяются для ограничения паттерна формой биома
- Сложные паттерны (`spots`, `hexagons`) могут быть более ресурсоемкими на очень больших картах
- При проблемах с производительностью: увеличьте `spacing` или уменьшите количество биомов с паттернами
