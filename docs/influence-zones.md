# Система сфер влияния (Influence Zones)

## Обзор

Система сфер влияния позволяет создавать глобальные объекты с зонами контроля, которые визуализируются на карте. Объекты одной стороны объединяют свои зоны, создавая общую территорию влияния (как в Stellaris).

## Proof of Concept (v1)

Текущая версия — базовый PoC с простой визуализацией через наложение полупрозрачных кругов.

## Типы акторов

### Global Object

Новый тип актора для представления объектов со сферами влияния.

**Параметры:**
- `gRange` (number) — радиус сферы влияния в пикселях (по умолчанию: 100)
- `gPower` (number) — сила влияния, определяет приоритет при столкновениях (по умолчанию: 1)
- `gSide` (string) — сторона/фракция, объекты одной стороны объединяются (по умолчанию: "neutral")

## Использование

### Создание Global Object

1. Создайте нового актора через Actors Directory
2. Выберите тип: **Global Object**
3. Настройте параметры:
   - **Range** — радиус влияния
   - **Power** — сила (для будущих механик столкновений)
   - **Side** — название стороны (например: "ally", "enemy", "faction1")

### Размещение на сцене

1. Перетащите Global Object на сцену как обычный токен
2. Разместите несколько объектов с разными параметрами
3. Объекты с одинаковым `gSide` будут визуально объединяться

### Визуализация зон влияния

**Показать зоны:**
```js
game.spaceholder.showInfluence()
```

**Скрыть зоны:**
```js
game.spaceholder.hideInfluence()
```

Или через консоль:
```js
// Прямой доступ к менеджеру
game.spaceholder.influenceManager.drawInfluenceZones()
game.spaceholder.influenceManager.clearAll()
```

## Цвета по умолчанию

- `neutral` — серый (0x808080)
- `ally` — зелёный (0x00AA00)
- `enemy` — красный (0xAA0000)
- `faction1` — синий (0x0088FF)
- `faction2` — оранжевый (0xFF8800)
- `faction3` — пурпурный (0xFF00FF)

Для других названий сторон используется серый цвет.

## Визуальное поведение

- **Одна сторона:** круги одной стороны накладываются друг на друга, создавая эффект объединённой территории
- **Разные стороны:** каждая сторона имеет свой цвет, области могут пересекаться

## Технические детали

### InfluenceManager

Класс `InfluenceManager` управляет визуализацией:

**Методы:**
- `initialize()` — инициализация контейнера PIXI
- `collectGlobalObjects()` — сбор всех Global Objects на сцене
- `drawInfluenceZones()` — отрисовка зон влияния
- `clearAll()` — очистка всей графики
- `destroy()` — полное уничтожение менеджера

**Доступ:**
```js
game.spaceholder.influenceManager
```

### Структура данных

Global Objects на сцене собираются в массив:
```js
{
  token: Token,
  gRange: number,
  gPower: number,
  gSide: string,
  position: {x: number, y: number}
}
```

## Планы развития

### v2: Настоящее объединение геометрии
- Использование библиотеки вычислительной геометрии (martinez-polygon-clipping или polybooljs)
- Точное объединение (union) кругов одной стороны в один контур
- Вычитание (subtract) областей разных сторон

### v3: Механики столкновений
- Использование `gPower` для определения границы между фракциями
- Визуализация "линии фронта" между враждебными сторонами
- Смещение границы в сторону более слабой фракции

### v4: Динамическое обновление
- Автоматический пересчёт при движении токенов
- Анимации изменения границ
- Оптимизация производительности для большого количества объектов

## Примеры использования

### Пример 1: Две враждующие фракции
```js
// Создайте 3-4 Global Objects с gSide="ally" и gRange=150
// Создайте 3-4 Global Objects с gSide="enemy" и gRange=150
// Разместите их на карте группами
game.spaceholder.showInfluence()
// Вы увидите две цветные территории
```

### Пример 2: Три нейтральные зоны
```js
// Создайте Global Objects с разными gSide: "faction1", "faction2", "faction3"
// Каждая получит свой цвет
game.spaceholder.showInfluence()
```

## Troubleshooting

**Зоны не отображаются:**
- Проверьте, что на сцене есть токены с типом актора `globalobject`
- Убедитесь, что `gRange > 0`
- Проверьте консоль на наличие ошибок

**Цвет не тот, что ожидался:**
- Проверьте точное написание `gSide` (регистр важен)
- Используйте предопределённые названия или настройте `influenceManager.defaultColors`

**Производительность:**
- Текущая версия рисует отдельные круги для каждого объекта
- При большом количестве объектов (>100) возможны задержки
- Планируется оптимизация в будущих версиях
